{% extends "base.html" %}

{% block body %}
    <div style="width: 100%; padding: 20px;">
        <div style="float: left; width: 50%;">
            <div id="qrcode"></div>
        </div>
        <div style="float: right; width: 50%;">
            <table class="pure-table" id="progress">
                <tr>
                    <td>Key</td>
                    {% for char in game.key %}
                        <td>{{ char }}</td>
                    {% endfor %}
                </tr>
                <tr>
                    <td>Progress</td>
                    {% for char in game.progress %}
                        <td>{{ char }}</td>
                    {% endfor %}
                </tr>
            </table>
            <a href="end">New game</a></div>
    </div>
    <script>
    $('#qrcode').qrcode({render: 'table',text: "{{ game.code }}", width: ($(window).width()/2) -20, height: ($(window).width()/2) - 20});

    </script>
	<script type='text/javascript'>
		(function poll(){
			setTimeout(function(){
				console.log("calling myslef");
				var data = {
					'game': "{{ game.code }}"
				};
				$.ajax({ url: "/get_progress", data, success: function(data){
					//replace progress table with data from server
					var progress = document.getElementById("progress").rows[1].cells;	
					data = data.split("");
					console.log(data);
					for (i = 1; i < 6; i++) {
						progress[i].innerHTML = data[i - 1];
					}
					//Setup the next poll recursively
					poll();
				}});
			}, 3000);
		})();
		
	</script>

{% endblock %}
